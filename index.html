<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ReviewCash</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
  <style>
    :root {
      --bg: #0a0a14; --glass: rgba(20,20,38,0.85); --neon: #00ffff; --success: #00ff88; --danger: #ff3366;
      --border: rgba(0,255,255,0.4); --text: #e0f7ff; --muted: #88c0d0;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { background: var(--bg); color: var(--text); font-family: system-ui, sans-serif; min-height: 100vh; overflow: hidden; }
    .container { max-width: 420px; margin: 0 auto; padding: 16px 16px 140px; }

    .page {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      transition: transform 0.5s cubic-bezier(0.25, 0.8, 0.25, 1);
      z-index: 10; padding-bottom: 120px; overflow-y: auto;
      -webkit-overflow-scrolling: touch;
    }
    .page.hidden-left { transform: translateX(-100%); }
    .page.hidden-right { transform: translateX(100%); }
    .page.visible { transform: translateX(0); }

    .header h1 {
      text-align: center; font-size: 28px; font-weight: 900; margin: 20px 0;
      background: linear-gradient(90deg, #00ffff, #00ff88);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    }

    /* ПРОФИЛЬ — АВАТАРКА ИЗ ТГ */
    .profile-header {
      text-align: center; padding: 30px 20px 10px;
    }
    .profile-avatar {
      width: 110px; height: 110px; border-radius: 50%; border: 5px solid var(--neon);
      object-fit: cover; box-shadow: 0 0 60px rgba(0,255,255,0.7); margin-bottom: 16px;
    }
    .profile-name {
      font-size: 24px; font-weight: 900; color: white;
    }
    .profile-id {
      font-size: 14px; color: var(--muted); margin-top: 6px;
    }

    .profile-card {
      background: var(--glass); backdrop-filter: blur(20px); border: 3px solid var(--neon);
      border-radius: 32px; padding: 24px; margin: 20px 0; text-align: center;
    }
    .balance { font-size: 48px; font-weight: 900; color: var(--success); margin: 10px 0; }
    .stats { display: flex; justify-content: space-around; margin: 30px 0; }
    .stat { text-align: center; }
    .stat-value { font-size: 32px; font-weight: 900; color: white; }
    .stat-label { font-size: 14px; color: var(--muted); }

    .btn { width: 100%; padding: 18px; margin: 12px 0; border: none; border-radius: 28px; font-weight: 900; font-size: 18px; cursor: pointer; }
    .btn-withdraw { background: linear-gradient(45deg, var(--danger), #ff1a50); color: white; box-shadow: 0 0 40px rgba(255,51,102,0.5); }

    .ref-link {
      background: #000; padding: 16px; border-radius: 20px; margin: 20px 0;
      word-break: break-all; font-size: 14px; text-align: center; color: var(--neon);
    }

    /* ФИЛЬТР — ЛИСТАЕТСЯ */
    .filter-bar {
      display: flex; gap: 12px; padding: 14px 16px;
      overflow-x: auto; scrollbar-width: none; white-space: nowrap;
      -webkit-overflow-scrolling: touch;
      margin: 16px 0;
      background: rgba(20,20,38,0.8);
      border-radius: 32px;
      border: 2px solid rgba(0,255,255,0.25);
    }
    .filter-bar::-webkit-scrollbar { display: none; }
    .filter-btn {
      padding: 13px 20px; background: rgba(0,255,255,0.15);
      border: 3px solid var(--neon); border-radius: 30px;
      color: white; font-weight: 900; font-size: 15px;
      cursor: pointer; display: inline-flex; align-items: center; gap: 9px;
      min-width: fit-content; flex-shrink: 0;
      transition: all 0.35s ease;
      box-shadow: 0 0 25px rgba(0,255,255,0.3);
    }
    .filter-btn.active {
      background: var(--neon); color: #000; transform: scale(1.08);
      box-shadow: 0 0 55px rgba(0,255,255,0.95);
    }
    .filter-btn i { font-size: 22px; }

    .bottom-nav {
      position: fixed; bottom: 20px; left: 20px; right: 20px;
      background: rgba(20,20,38,0.95); backdrop-filter: blur(25px);
      border: 3px solid var(--border); border-radius: 36px; padding: 10px;
      display: flex; box-shadow: 0 40px 80px rgba(0,0,0,0.9); z-index: 999;
    }
    .nav-btn {
      flex: 1; padding: 18px; border: none; border-radius: 28px;
      font-weight: 800; font-size: 17px; background: transparent; color: var(--muted);
      transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
    }
    .nav-btn.active {
      background: linear-gradient(45deg, #00ffff, #00ff88); color: #000;
      transform: translateY(-6px); box-shadow: 0 0 60px rgba(0,255,255,0.8);
    }
  </style>
</head>
<body>

  <!-- ЗАДАНИЯ -->
  <div id="tasks-page" class="page visible">
    <div class="container">
      <div class="header"><h1>ЗАДАНИЯ</h1></div>
      <!-- ... весь код заданий как раньше ... -->
      <div class="role-switch">
        <div class="role-btn active" id="employer-btn" onclick="switchRole('employer')">РАБОТОДАТЕЛЬ</div>
        <div class="role-btn" id="worker-btn" onclick="switchRole('worker')">ИСПОЛНИТЕЛЬ</div>
      </div>
      <div id="employer-mode">/* создание задания */</div>
      <div id="worker-mode" style="display:none;">
        <div class="filter-bar">
          <div class="filter-btn active" onclick="filterTasks('all')"><i class="fas fa-th-large"></i> ВСЕ</div>
          <div class="filter-btn" onclick="filterTasks('yandex')"><i class="fab fa-yandex" style="color:#ffcc00"></i> Яндекс</div>
          <div class="filter-btn" onclick="filterTasks('google')"><i class="fab fa-google" style="color:#4285f4"></i> Google</div>
          <div class="filter-btn" onclick="filterTasks('telegram')"><i class="fab fa-telegram-plane" style="color:#229ed9"></i> TG</div>
        </div>
        <div id="tasks-list"></div>
      </div>
    </div>
  </div>

  <!-- ПРОФИЛЬ — ЧИСТЫЙ, С АВАТАРКОЙ ИЗ ТГ -->
  <div id="profile-page" class="page hidden-right">
    <div class="container">
      <div class="header"><h1>ПРОФИЛЬ</h1></div>

      <div class="profile-header">
        <img id="user-avatar" class="profile-avatar" src="" alt="Аватар">
        <div class="profile-name" id="user-name">Загрузка...</div>
        <div class="profile-id">@username</div>
      </div>

      <div class="profile-card">
        <div class="balance" id="user-balance">0 ₽</div>
        <p style="color:var(--muted);">Доступно для вывода</p>
      </div>

      <div class="stats">
        <div class="stat"><div class="stat-value" id="tasks-done">0</div><div class="stat-label">Выполнено</div></div>
        <div class="stat"><div class="stat-value" id="earned-total">0 ₽</div><div class="stat-label">Заработано</div></div>
        <div class="stat"><div class="stat-value" id="ref-count">0</div><div class="stat-label">Рефералов</div></div>
      </div>

      <button class="btn btn-withdraw" onclick="openWithdraw()">ВЫВОД ОТ 250 ₽</button>

      <div class="ref-link" id="ref-link">t.me/ReviewCashBot?start=123456789</div>
      <p style="text-align:center; color:var(--muted); font-size:13px;">Твоя реферальная ссылка</p>
    </div>
  </div>

  <div class="bottom-nav">
    <button class="nav-btn active" onclick="showPage('tasks')">Задания</button>
    <button class="nav-btn" onclick="showPage('profile')">Профиль</button>
  </div>

  <!-- МОДАЛКА ВЫВОДА -->
  <div id="withdraw-modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.95); z-index:1000; justify-content:center; align-items:center; padding:20px;">
    <div style="background:var(--glass); border:3px solid var(--neon); border-radius:32px; padding:40px 28px; width:100%; max-width:460px; text-align:center; position:relative;">
      <button onclick="closeWithdraw()" style="position:absolute; top:16px; right:16px; background:none; border:none; color:var(--neon); font-size:32px; cursor:pointer;">×</button>
      <h2 style="color:var(--danger); font-size:32px; margin-bottom:20px;">ВЫВОД СРЕДСТВ</h2>
      <input type="text" id="withdraw-method" placeholder="Номер карты / телефон">
      <input type="text" id="withdraw-fio" placeholder="ФИО или ник">
      <input type="number" id="withdraw-amount" placeholder="Сумма (мин. 250 ₽)" min="250">
      <p style="margin:20px 0; color:#88c0d0; font-size:15px;">Мы пополним баланс в течение дня</p>
      <button onclick="sendWithdraw()" style="width:100%; padding:20px; background:linear-gradient(45deg,var(--danger),#ff1a50); color:white; border:none; border-radius:28px; font-weight:900; font-size:20px;">ОТПРАВИТЬ ЗАЯВКУ</button>
    </div>
  </div>

  <script>
    const tg = window.Telegram.WebApp;
    tg.ready(); tg.expand();

    // АВАТАРКА И ИМЯ ИЗ TELEGRAM
    const user = tg.initDataUnsafe.user;
    if (user) {
      document.getElementById('user-name').innerText = user.first_name + (user.last_name ? ' ' + user.last_name : '');
      document.getElementById('user-avatar').src = user.photo_url || 'https://telegram.org/img/t_logo.png';
      document.getElementById('ref-link').innerText = `t.me/ReviewCashBot?start=${user.id}`;
    }

    // Остальной код (задания, фильтр, вывод и т.д.) — без изменений
    // (вставь сюда весь предыдущий JS из последней рабочей версии)

    tg.onEvent('webAppDataReceived', data => {
      try {
        const res = JSON.parse(data);
        if (res.user) {
          document.getElementById('user-balance').innerText = res.user.balance + ' ₽';
          document.getElementById('tasks-done').innerText = res.user.tasks_done || 0;
          document.getElementById('earned-total').innerText = res.user.earned + ' ₽';
          document.getElementById('ref-count').innerText = res.user.refs || 0;
        }
      } catch(e) {}
    });
  </script>
</body>
</html>
