<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Профиль | ReviewCash</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body style="margin:0;background:#0f0f23;color:#fff;font-family:system-ui,sans-serif;min-height:100vh;overflow-x:hidden">
  
  <div style="max-width:420px;margin:0 auto;padding:16px;text-align:center">
    <h1 style="color:#00ffff;font-size:28px;font-weight:900;margin:20px 0">ПРОФИЛЬ</h1>
    
    <img id="avatar" src="" style="width:80px;height:80px;border-radius:50%;border:3px solid #00ffff;margin:0 auto 10px;display:block">
    <div id="username" style="font-size:20px;font-weight:700;margin:12px 0">@User</div>

    <div style="background:#1a1a2e;padding:20px;border-radius:20px;margin:20px 0;border:1px solid rgba(0,255,255,0.3)">
      <div style="font-size:14px;color:#88c0d0">БАЛАНС</div>
      <div style="font-size:32px;font-weight:900;color:#00ff88;margin:8px 0">
        <span id="balance">0.00</span> ₽
      </div>
      <button onclick="fetchBalance()" style="padding:10px 24px;background:rgba(255,255,255,0.2);border:none;border-radius:30px;font-size:14px;font-weight:600">
        Обновить
      </button>
    </div>

    <!-- ДВЕ КНОПКИ — ВИДНЫ ВСЕГДА -->
    <div style="display:flex;gap:12px;margin:20px 0">
      <button onclick="openTopup()" style="flex:1;padding:18px;background:#00ff88;color:#000;border:none;border-radius:16px;font-weight:700;font-size:17px">
        ПОПОЛНИТЬ
      </button>
      <button onclick="openWithdraw()" style="flex:1;padding:18px;background:#ff3366;color:#fff;border:none;border-radius:16px;font-weight:700;font-size:17px">
        ВЫВОД
      </button>
    </div>
  </div>

  <!-- НИЖНИЕ КНОПКИ — КАК НА ТВОЁМ СКРИНЕ -->
  <div style="position:fixed;bottom:20px;left:50%;transform:translateX(-50%);width:340px;max-width:90%;background:rgba(15,15,35,0.95);backdrop-filter:blur(20px);border-radius:30px;padding:8px;display:flex;border:1px solid rgba(0,255,255,0.4);box-shadow:0 10px 30px rgba(0,0,0,0.6);z-index:999;overflow:hidden">
    <button onclick="location.href='index.html'" style="flex:1;padding:16px 24px;border:none;border-radius:25px;font-weight:800;font-size:18px;background:transparent;color:#88c0d0;transition:all .4s">
      Задания
    </button>
    <button style="flex:1;padding:16px 24px;border:none;border-radius:25px;font-weight:900;font-size:18px;background:linear-gradient(135deg,#00ffff,#00ff88);color:#000;box-shadow:0 0 30px rgba(0,255,255,0.8);transform:translateY(-3px)">
      Профиль
    </button>
  </div>

  <!-- ПОПОЛНЕНИЕ -->
  <div id="topup-modal" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.95);z-index:999;justify-content:center;align-items:center;padding:20px">
    <div style="background:#1a1a2e;border:2px solid #00ffff;border-radius:24px;padding:24px;width:100%;max-width:400px;position:relative">
      <button onclick="closeTopup()" style="position:absolute;top:16px;right:16px;background:none;border:none;color:#00ffff;font-size:32px">×</button>
      <h2 style="color:#00ffff;text-align:center;margin-bottom:20px">Пополнение</h2>
      <input type="number" id="topup-amount" placeholder="Сумма (мин. 100 ₽)" style="width:100%;padding:16px;margin:10px 0;border-radius:12px;background:rgba(255,255,255,0.1);border:1px solid #00ffff;color:#fff;font-size:16px">
      <div id="topup-details" style="display:none;margin:20px 0">
        <p style="text-align:center">Переведи <b>ровно</b>:</p>
        <div style="background:rgba(255,255,255,0.05);padding:16px;border-radius:12px;border:1px solid #00ffff;margin:10px 0;font-size:18px">
          <p><b>Номер:</b> +7 (960) 073-85-59</p>
          <p><b>Имя:</b> Раяз Н.</p>
          <p><b>Банк:</b> Т-Банк</p>
        </div>
        <p style="text-align:center">Код: <span id="topup-code" style="font-size:36px;color:#ffd700;font-weight:900">000000</span></p>
      </div>
      <button onclick="sendTopup()" style="width:100%;padding:18px;background:#00ff88;color:#000;border:none;border-radius:16px;font-weight:700">
        ОТПРАВИТЬ ЗАЯВКУ
      </button>
    </div>
  </div>

  <!-- ВЫВОД — ВЕРНУЛ! -->
  <div id="withdraw-modal" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.95);z-index:999;justify-content:center;align-items:center;padding:20px">
    <div style="background:#1a1a2e;border:2px solid #ff3366;border-radius:24px;padding:24px;width:100%;max-width:400px;position:relative">
      <button onclick="closeWithdraw()" style="position:absolute;top:16px;right:16px;background:none;border:none;color:#ff3366;font-size:32px">×</button>
      <h2 style="color:#ff3366;text-align:center;margin-bottom:20px">Вывод средств</h2>
      <input type="text" id="withdraw-method" placeholder="Карта или телефон" style="width:100%;padding:16px;margin:10px 0;border-radius:12px;background:rgba(255,255,255,0.1);border:1px solid #ff3366;color:#fff">
      <input type="text" id="withdraw-fio" placeholder="ФИО получателя" style="width:100%;padding:16px;margin:10px 0;border-radius:12px;background:rgba(255,255,255,0.1);border:1px solid #ff3366;color:#fff">
      <input type="text" id="withdraw-bank" placeholder="Банк (Тинькофф, Сбер и т.д.)" style="width:100%;padding:16px;margin:10px 0;border-radius:12px;background:rgba(255,255,255,0.1);border:1px solid #ff3366;color:#fff">
      <input type="number" id="withdraw-amount" placeholder="Сумма (мин. 500 ₽)" style="width:100%;padding:16px;margin:10px 0;border-radius:12px;background:rgba(255,255,255,0.1);border:1px solid #ff3366;color:#fff">
      <button onclick="sendWithdraw()" style="width:100%;padding:18px;background:#ff3366;color:#fff;border:none;border-radius:16px;font-weight:700;margin-top:20px">
        ОТПРАВИТЬ ЗАЯВКУ
      </button>
    </div>
  </div>

  <script>
    const tg = window.Telegram.WebApp; tg.ready(); tg.expand();

    document.getElementById('avatar').src = tg.initDataUnsafe.user?.photo_url || 'https://via.placeholder.com/80/00ffff/000?text=RC';
    document.getElementById('username').innerText = '@' + (tg.initDataUnsafe.user?.username || 'User');

    function fetchBalance() {
      document.getElementById('balance').innerText = '...';
      tg.sendData(JSON.stringify({action:"get_balance"}));
    }

    tg.onEvent('webAppDataReceived', d => {
      try {
        const r = JSON.parse(d);
        if (r.balance !== undefined) document.getElementById('balance').innerText = r.balance.toFixed(2);
        if (r.success) tg.showAlert("Заявка отправлена!");
      } catch(e) {}
    });

    function openTopup() { document.getElementById('topup-modal').style.display = 'flex'; }
    function closeTopup() { 
      document.getElementById('topup-modal').style.display = 'none'; 
      document.getElementById('topup-details').style.display = 'none'; 
    }
    function sendTopup() {
      const amount = parseFloat(document.getElementById('topup-amount').value);
      if (!amount || amount < 100) return tg.showAlert("Минимум 100 ₽");
      const code = Math.floor(100000 + Math.random() * 900000);
      document.getElementById('topup-code').innerText = code;
      document.getElementById('topup-details').style.display = 'block';
      tg.sendData(JSON.stringify({action:"request_topup", amount, code}));
    }

    function openWithdraw() { document.getElementById('withdraw-modal').style.display = 'flex'; }
    function closeWithdraw() { document.getElementById('withdraw-modal').style.display = 'none'; }
    function sendWithdraw() {
      const method = document.getElementById('withdraw-method').value.trim();
      const fio = document.getElementById('withdraw-fio').value.trim();
      const bank = document.getElementById('withdraw-bank').value.trim();
      const amount = parseFloat(document.getElementById('withdraw-amount').value);
      if (!method || !fio || !bank || !amount || amount < 500) return tg.showAlert("Заполни все поля! Мин. 500 ₽");
      tg.sendData(JSON.stringify({action:"request_withdraw", method, fio, bank, amount}));
    }

    window.onload = () => { fetchBalance(); setInterval(fetchBalance, 8000); };
  </script>
</body>
</html>
