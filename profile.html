<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Профиль | ReviewCash</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{background:#0f0f23;color:#fff;font-family:system-ui,sans-serif;min-height:100vh}
    .container{max-width:420px;margin:0 auto;padding:16px}
    .card{background:rgba(255,255,255,0.08);border-radius:20px;padding:20px;margin:16px 0;border:1px solid rgba(0,255,255,0.3)}
    h1{text-align:center;color:#00ffff;font-size:28px;margin:20px 0;font-weight:900}
    .avatar{width:80px;height:80px;border-radius:50%;border:3px solid #00ffff;margin:0 auto 10px;display:block}
    .balance{text-align:center;background:#1a1a2e;padding:16px;border-radius:16px;margin:16px 0}
    .balance span{font-size:32px;font-weight:900;color:#00ff88}
    .btn{display:block;width:100%;padding:18px;margin:12px 0;border:none;border-radius:16px;font-weight:700;font-size:17px;cursor:pointer}
    .topup{background:#00ff88;color:#000}
    .withdraw{background:#ff3366;color:#fff}
    .create{background:#0066ff;color:#fff;font-size:18px !important;padding:20px !important}
    .bottom-nav{position:fixed;bottom:16px;left:16px;right:16px;background:rgba(0,0,0,0.8);backdrop-filter:blur(20px);border-radius:20px;padding:12px;display:flex;gap:10px;border:1px solid rgba(0,255,255,0.4)}
    .nav-btn{flex:1;padding:16px;border-radius:16px;font-weight:800;background:transparent;color:#88c0d0}
    .nav-btn.active{background:#00ffff;color:#000}
  </style>
</head>
<body>
  <div class="container">
    <h1>ПРОФИЛЬ</h1>
    
    <img id="avatar" src="" class="avatar">
    <div style="text-align:center;font-size:20px;font-weight:700;margin-bottom:20px" id="username">@User</div>

    <div class="balance card">
      БАЛАНС<br>
      <span id="balance">0.00</span> ₽
      <button onclick="fetchBalance()" style="margin-top:10px;padding:8px 20px;background:rgba(255,255,255,0.2);border-radius:12px;border:none;color:#fff;font-size:14px">Обновить</button>
    </div>

    <button class="btn topup" onclick="openTopup()">ПОПОЛНИТЬ</button>
    <button class="btn withdraw" onclick="openWithdraw()">ВЫВОД</button>
    
    <button class="btn create" onclick="openCreateTask()">+ СОЗДАТЬ ЗАДАНИЕ</button>
  </div>

  <!-- ФОРМА СОЗДАНИЯ ЗАДАНИЯ -->
  <div id="create-modal" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.95);z-index:999;justify-content:center;align-items:center;padding:20px">
    <div style="background:#1a1a2e;border:2px solid #00ffff;border-radius:24px;padding:24px;width:100%;max-width:400px">
      <h2 style="color:#00ffff;text-align:center;margin-bottom:20px">Создать задание</h2>
      <input type="text" id="task-title" placeholder="Название (напр. Подписка)" style="width:100%;padding:16px;margin:10px 0;border-radius:12px;background:rgba(255,255,255,0.1);border:1px solid #00ffff;color:#fff;font-size:16px">
      <input type="number" id="task-reward" placeholder="Награда в ₽" style="width:100%;padding:16px;margin:10px 0;border-radius:12px;background:rgba(255,255,255,0.1);border:1px solid #00ffff;color:#fff;font-size:16px">
      <input type="url" id="task-link" placeholder="Ссылка (Telegram, YouTube и т.д.)" style="width:100%;padding:16px;margin:10px 0;border-radius:12px;background:rgba(255,255,255,0.1);border:1px solid #00ffff;color:#fff;font-size:16px">
      <div style="display:flex;gap:10px;margin-top:20px">
        <button onclick="document.getElementById('create-modal').style.display='none'" style="flex:1;padding:16px;background:#666;border-radius:12px">Отмена</button>
        <button onclick="sendTask()" style="flex:1;padding:16px;background:#00ff88;color:#000;border-radius:12px;font-weight:700">Создать</button>
      </div>
    </div>
  </div>

  <div class="bottom-nav">
    <button class="nav-btn" onclick="location.href='index.html'">Задания</button>
    <button class="nav-btn active">Профиль</button>
  </div>

  <script>
    const tg = window.Telegram.WebApp; tg.ready(); tg.expand();

    document.getElementById('avatar').src = tg.initDataUnsafe.user?.photo_url || 'https://via.placeholder.com/80/00ffff/000?text=RC';
    document.getElementById('username').innerText = '@' + (tg.initDataUnsafe.user?.username || 'User');

    function fetchBalance() {
      document.getElementById('balance').innerText = '...';
      tg.sendData(JSON.stringify({action:"get_balance"}));
    }

    tg.onEvent('webAppDataReceived', d => {
      try { const r = JSON.parse(d);
        if (r.balance !== undefined) document.getElementById('balance').innerText = r.balance.toFixed(2);
        if (r.task_created) { tg.showAlert("Задание создано!"); document.getElementById('create-modal').style.display='none'; }
      } catch(e) {}
    });

    function openCreateTask() { document.getElementById('create-modal').style.display = 'flex'; }
    function sendTask() {
      const title = document.getElementById('task-title').value.trim();
      const reward = document.getElementById('task-reward').value;
      const link = document.getElementById('task-link').value.trim();
      if (!title || !reward || !link) return tg.showAlert("Заполни все поля!");
      tg.sendData(JSON.stringify({action:"create_task", title, reward: parseFloat(reward), link}));
    }

    function openTopup() { /* твой код пополнения */ }
    function openWithdraw() { /* твой код вывода */ }

    window.onload = () => { fetchBalance(); setInterval(fetchBalance, 8000); };
  </script>
</body>
</html>
