<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>üõ° ReviewCash ‚Äî –ú–æ–¥–µ—Ä–∞—Ç–æ—Ä</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet"/>
<style>
body { font-family:'Inter',sans-serif; background:#111; color:#ccc; margin:0; }
.header { display:flex; justify-content:space-between; padding:16px; background:#222; }
.btn { padding:10px 14px; border-radius:12px; border:none; background:#38bdf8; color:#fff; cursor:pointer; font-weight:600; transition:background 0.2s; margin-top:10px; }
.btn:hover { background:#4ccaff; }
section { display:none; padding:16px; }
section.active { display:block; }
table { width:100%; border-collapse: collapse; }
th, td { padding:8px; border-bottom:1px solid #444; font-size:13px; }
th { background:#333; font-weight:600; }
</style>
</head>
<body>
<div class="header"><h1>üõ° –ú–æ–¥–µ—Ä–∞—Ç–æ—Ä</h1>
<button id="refreshBtn">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button></div>
<div style="display:flex; gap:8px; padding:16px;">
  <button class="btn" data-tab="queue">üìã –û—á–µ—Ä–µ–¥—å</button>
  <button class="btn" data-tab="proofs">üì∏ –î–æ–∫—É–º–µ–Ω—Ç—ã</button>
  <button class="btn" data-tab="stats">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
</div>
<!-- –û—á–µ—Ä–µ–¥—å -->
<section id="tab-queue" class="active">
<h2>–û—á–µ—Ä–µ–¥—å —Ä–µ–≤—å—é</h2>
<div id="queueList"></div>
</section>
<!-- –î–æ–∫—É–º–µ–Ω—Ç—ã -->
<section id="tab-proofs">
<h2>–î–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞</h2>
<div id="proofsList"></div>
</section>
<!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
<section id="tab-stats">
<h2>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞</h2>
<div id="statsData"></div>
</section>
<script>
const tabs=document.querySelectorAll('[data-tab]');
let currentTab='queue';
tabs.forEach(t=>{
  t.onclick=()=>{
    document.querySelectorAll('section').forEach(s=>s.classList.remove('active'));
    document.getElementById('tab-'+t.dataset['tab']).classList.add('active');
    currentTab=t.dataset['tab'];
    loadCurrentTab();
  }
});
document.getElementById('refreshBtn').onclick=()=>loadCurrentTab();

function loadCurrentTab() {
  if(currentTab==='queue') loadQueue();
  if(currentTab==='proofs') loadProofs();
  if(currentTab==='stats') loadStats();
}

function loadQueue() {
  fetch('/api/moderator/queue').then(r=>r.json()).then(d=>{
    const container=document.getElementById('queueList'); container.innerHTML='';
    d.items.forEach(i=>{
      const div=document.createElement('div');
      div.innerHTML=`<b>${i.title}</b> (${i.type})<br>
      –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${i.user_id}<br>
      <button onclick='acceptReview("${i.id}")'>–ü—Ä–∏–Ω—è—Ç—å</button>
      <button onclick='rejectReview("${i.id}")'>–û—Ç–∫–ª–æ–Ω–∏—Ç—å</button>`;
      container.appendChild(div);
    });
  });
}
function loadProofs() {
  fetch('/api/moderator/proofs').then(r=>r.json()).then(d=>{
    const container=document.getElementById('proofsList'); container.innerHTML='';
    d.items.forEach(p=>{
      const div=document.createElement('div');
      div.style.background='#222'; div.style.margin='8px 0'; div.style.padding='8px'; div.style.borderRadius='12px';
      if(p.type==='image') {
        div.innerHTML=`<img src="${p.data}" style="max-width:100%"><br>`;
      } else {
        div.innerHTML=`<a href="${p.data}" target="_blank">${p.data}</a>`;
      }
      div.innerHTML+=`<br>
      <button onclick='acceptProof("${p.id}")'>–ü—Ä–∏–Ω—è—Ç—å</button>
      <button onclick='rejectProof("${p.id}")'>–û—Ç–∫–ª–æ–Ω–∏—Ç—å</button>`;
      container.appendChild(div);
    });
  });
}
function loadStats() {
  fetch('/api/moderator/stats').then(r=>r.json()).then(d=>{
    const c=document.getElementById('statsData'); c.innerHTML='';
    d.admins.forEach(a=>{
      c.innerHTML+=`<div>${a.name || a.id} ‚Äî –ø—Ä–æ–≤–µ—Ä–∏–ª: ${a.tasks_reviewed}</div>`;
    });
  });
}

function acceptReview(id){ fetch('/api/moderator/review/'+id+'/accept',{method:'POST'}).then(()=>loadCurrentTab()); }
function rejectReview(id){ fetch('/api/moderator/review/'+id+'/reject',{method:'POST'}).then(()=>loadCurrentTab()); }
function acceptProof(id){ fetch('/api/moderator/proof/'+id+'/accept',{method:'POST'}).then(()=>loadCurrentTab()); }
function rejectProof(id){ fetch('/api/moderator/proof/'+id+'/reject',{method:'POST'}).then(()=>loadCurrentTab()); }

loadCurrentTab();
</script>
</body>
</html>
