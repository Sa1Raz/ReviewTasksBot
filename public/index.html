<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>ReviewCash — Империя отзывов</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
  <style>
    :root{--bg:#0a0014;--glass:rgba(15,10,45,0.98);--neon:#00ffff;--green:#00ff88;--gold:#ffd700;--danger:#ff3366;--border:rgba(0,255,255,0.6);--text:#e0f7ff;--muted:#88c0d0;}
    *{margin:0;padding:0;box-sizing:border-box;}
    body{background:linear-gradient(135deg,#0a0014,#001133);color:var(--text);font-family:-apple-system,system-ui,sans-serif;min-height:100vh;overflow-x:hidden;}
    .container{max-width:420px;margin:0 auto;padding:16px 16px 140px;position:relative;}
    .header h1{font-size:38px;font-weight:900;text-align:center;padding:30px 0 10px;background:linear-gradient(90deg,#00ffff,#00ff88,#ffd700);-webkit-background-clip:text;-webkit-text-fill-color:transparent;text-shadow:0 0 40px rgba(0,255,255,0.6);}
    .support-btn{position:absolute;top:16px;right:16px;width:48px;height:48px;background:rgba(0,136,204,0.3);border:2.5px solid var(--neon);border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;box-shadow:0 0 35px rgba(0,255,255,0.5);backdrop-filter:blur(12px);z-index:1000;}
    .role-switch{display:flex;background:rgba(20,20,50,0.9);border:3px solid var(--border);border-radius:32px;padding:8px;margin:20px 0;backdrop-filter:blur(20px);}
    .role-btn{flex:1;padding:16px;border-radius:26px;font-weight:900;font-size:15.5px;text-align:center;color:var(--muted);cursor:pointer;transition:.5s;}
    .role-btn.active{background:linear-gradient(135deg,var(--neon),var(--green));color:#000;box-shadow:0 0 60px rgba(0,255,255,0.8);transform:translateY(-4px);}
    .create-btn{width:100%;padding:26px;background:linear-gradient(45deg,#ffd700,#ff8c00);color:#000;border:none;border-radius:32px;font-size:24px;font-weight:900;margin:20px 0;cursor:pointer;box-shadow:0 15px 50px rgba(255,215,0,0.6);text-transform:uppercase;letter-spacing:1.5px;}
    .create-form{background:var(--glass);border:3px solid var(--neon);border-radius:32px;padding:28px;margin:20px 0;display:none;backdrop-filter:blur(25px);box-shadow:0 20px 60px rgba(0,255,255,0.3);}
    .create-form.active{display:block;animation:slideDown .6s;}
    @keyframes slideDown{from{opacity:0;transform:translateY(-30px)}to{opacity:1;transform:translateY(0)}}
    input,select{width:100%;padding:18px;margin:14px 0;background:rgba(0,0,0,0.7);border:3px solid var(--neon);border-radius:20px;color:white;font-size:16px;font-weight:600;}
    .price-buttons{display:flex;gap:12px;overflow-x:auto;padding:16px 0;scrollbar-width:none;margin:20px 0;}
    .price-btn{padding:16px 26px;background:rgba(0,255,255,0.15);border:3px solid var(--neon);border-radius:30px;color:white;font-weight:900;font-size:15px;cursor:pointer;min-width:115px;text-align:center;transition:.4s;}
    .price-btn.active{background:var(--neon);color:#000;transform:scale(1.15);box-shadow:0 0 80px #00ffff;}
    .budget-result{background:linear-gradient(135deg,rgba(0,255,136,0.25),rgba(0,255,255,0.25));padding:26px;border-radius:24px;text-align:center;margin:20px 0;border:3px solid var(--green);font-size:20px;font-weight:900;color:var(--gold);line-height:1.5;min-height:85px;}
    .submit-create{width:100%;padding:26px;background:linear-gradient(45deg,var(--green),#00cc66);color:black;border:none;border-radius:32px;font-size:24px;font-weight:900;margin-top:30px;cursor:pointer;text-transform:uppercase;}
    .filter-bar{display:flex;gap:16px;padding:20px 16px;overflow-x:auto;scrollbar-width:none;margin:20px 0;background:rgba(20,20,50,0.9);border-radius:32px;border:3px solid var(--border);backdrop-filter:blur(20px);}
    .filter-btn{padding:16px 26px;background:rgba(0,255,255,0.15);border:3px solid var(--neon);border-radius:30px;color:white;font-weight:900;display:flex;flex-direction:column;align-items:center;gap:8px;min-width:90px;cursor:pointer;transition:.4s;}
    .filter-btn i{font-size:28px;}
    .filter-btn span{font-size:13px;}
    .filter-btn.active{background:var(--neon);color:#000;transform:scale(1.15);box-shadow:0 0 80px #00ffff;}
    .profile-avatar{width:130px;height:130px;border-radius:50%;border:6px solid var(--neon);box-shadow:0 0 80px rgba(0,255,255,0.9);object-fit:cover;margin:20px auto;display:block;}
    .balance{font-size:56px;font-weight:900;color:var(--green);text-shadow:0 0 30px rgba(0,255,136,0.7);text-align:center;}
    .bottom-nav{position:fixed;bottom:20px;left:20px;right:20px;background:rgba(15,15,45,0.98);backdrop-filter:blur(30px);border:4px solid var(--border);border-radius:40px;padding:12px;display:flex;box-shadow:0 50px 100px rgba(0,0,0,0.9);z-index:999;}
    .nav-btn{flex:1;padding:20px;border:none;border-radius:32px;font-weight:900;font-size:18px;background:transparent;color:var(--muted);transition:.5s;}
    .nav-btn.active{background:linear-gradient(45deg,var(--neon),var(--green));color:#000;transform:translateY(-8px);box-shadow:0 0 70px rgba(0,255,255,0.9);}
    .copy-block{background:rgba(0,255,255,0.1);border:2px dashed var(--neon);border-radius:20px;padding:20px;margin:15px 0;text-align:center;cursor:pointer;transition:.4s;}
    .copy-block:hover{background:rgba(0,255,255,0.2);transform:scale(1.02);}
    .copy-text{font-size:26px;font-weight:900;color:var(--gold);}
    .copy-hint{font-size:14px;color:var(--muted);}
  </style>
</head>
<body>

<div id="main-page" class="container">
  <div class="header"><h1>REVIEWCASH</h1></div>

  <div class="role-switch">
    <div class="role-btn active" onclick="switchRole('employer')">РАБОТОДАТЕЛЬ</div>
    <div class="role-btn" onclick="switchRole('worker')">ИСПОЛНИТЕЛЬ</div>
  </div>

  <div id="employer-mode">
    <button class="create-btn" onclick="document.getElementById('create-form').classList.toggle('active')">
      + СОЗДАТЬ НОВОЕ ЗАДАНИЕ
    </button>

    <div class="create-form" id="create-form">
      <input type="text" id="task-title" placeholder="Например: 5 звёзд в Яндекс.Картах">
      <input type="url" id="task-link" placeholder="https://example.com">
      <select id="task-type" onchange="updateBudgetInfo();autoRoundBudget()">
        <option value="">Выберите тип</option>
        <option value="yandex">Яндекс Отзыв (100 ₽)</option>
        <option value="google">Google Отзыв (65 ₽)</option>
        <option value="telegram">Telegram Подписка (10 ₽)</option>
      </select>
      <input type="number" id="task-budget" placeholder="Сколько потратить (₽)" oninput="autoRoundBudget()">

      <div class="price-buttons">
        <div class="price-btn" onclick="setBudget(this,100)">100 ₽</div>
        <div class="price-btn" onclick="setBudget(this,200)">200 ₽</div>
        <div class="price-btn" onclick="setBudget(this,500)">500 ₽</div>
        <div class="price-btn" onclick="setBudget(this,1000)">1000 ₽</div>
        <div class="price-btn" onclick="setBudget(this,2000)">2000 ₽</div>
        <div class="price-btn" onclick="setBudget(this,3000)">3000 ₽</div>
      </div>

      <div class="budget-result" id="budget-result">Выберите тип и сумму</div>
      <button class="submit-create" onclick="createTask()">ОПУБЛИКОВАТЬ ЗАДАНИЕ</button>
    </div>
  </div>

  <div id="worker-mode" style="display:none;">
    <div class="filter-bar">
      <div class="filter-btn active" onclick="centerFilter(this)"><i class="fas fa-th-large"></i><span>ВСЕ</span></div>
      <div class="filter-btn" onclick="centerFilter(this)"><i class="fab fa-yandex"></i><span>ЯНДЕКС</span></div>
      <div class="filter-btn" onclick="centerFilter(this)"><i class="fab fa-google"></i><span>GOOGLE</span></div>
      <div class="filter-btn" onclick="centerFilter(this)"><i class="fab fa-telegram"></i><span>TG</span></div>
    </div>
    <div style="text-align:center;padding:80px;color:#888;"><h2>Задания скоро появятся</h2></div>
  </div>
</div>

<div id="profile-page" class="container" style="display:none;position:relative;">
  <div class="support-btn" onclick="tg.openTelegramLink('https://t.me/RapiHappy')">
    <i class="fas fa-headset"></i>
  </div>

  <div style="text-align:center;padding:40px 0;">
    <img id="user-avatar" class="profile-avatar" src="">
    <h2 style="color:white;margin:15px 0;font-size:26px;" id="user-name">Загрузка...</h2>
    <p style="color:#88c0d0;font-size:16px;" id="user-username">@username</p>
  </div>

  <div style="background:var(--glass);border:3px solid var(--neon);border-radius:32px;padding:30px;margin:20px 0;text-align:center;backdrop-filter:blur(20px);">
    <div class="balance" id="user-balance">0 ₽</div>
    <p style="margin-top:10px;color:#aaa;">Доступно для вывода</p>
  </div>

  <button class="create-btn" style="background:linear-gradient(45deg,#00cc66,#00ff88);" onclick="startTopUp()">ПОПОЛНИТЬ БАЛАНС</button>
  <button class="create-btn" style="background:linear-gradient(45deg,#ff3366,#ff1a50);margin-top:15px;" onclick="startWithdraw()">ВЫВОД СРЕДСТВ</button>
</div>

<div class="bottom-nav">
  <button class="nav-btn active" onclick="showPage('main')">Задания</button>
  <button class="nav-btn" onclick="showPage('profile')">Профиль</button>
</div>

<script>
  const tg = window.Telegram.WebApp;
  tg.ready(); tg.expand();
  const user = tg.initDataUnsafe.user || {};
  const prices = { yandex:100, google:65, telegram:10 };
  const minBudget = { yandex:100, google:65, telegram:10 };
  let roundTimeout;
  let userBalance = 0;

  // Профиль
  document.getElementById('user-name').innerText = user.first_name || 'Пользователь';
  document.getElementById('user-username').innerText = user.username ? '@'+user.username : '—';
  document.getElementById('user-avatar').src = user.photo_url || `https://api.dicebear.com/7.x/avataaars/svg?seed=${user.id || 'user'}`;
  document.getElementById('user-balance').innerText = userBalance.toLocaleString() + ' ₽';

  function copyToClipboard(text, el) {
    navigator.clipboard.writeText(text).then(() => {
      const orig = el.innerText;
      el.innerText = 'Скопировано!';
      el.style.color = '#00ff88';
      setTimeout(() => { el.innerText = orig; el.style.color = '#88c0d0'; }, 1500);
    });
  }

  // === ПОПОЛНЕНИЕ ===
  function startTopUp() {
    tg.showPopup({title:"Пополнение баланса",message:`<div style="padding:20px;text-align:center;">
      <input type="number" id="topupSum" placeholder="от 100 ₽" style="width:100%;padding:18px;margin:15px 0;background:rgba(0,0,0,0.7);border:3px solid #00ffff;border-radius:20px;color:white;font-size:18px;text-align:center;">
      <button onclick="showTopUpDetails()" style="width:100%;padding:18px;background:#00ff88;color:black;border:none;border-radius:20px;font-weight:900;margin-top:10px;cursor:pointer;">ДАЛЕЕ</button>
    </div>`,buttons:[{type:"close"}]});
  }

  function showTopUpDetails() {
    const amount = parseInt(document.getElementById('topupSum').value);
    if (!amount || amount < 100) return tg.showAlert("Минимум 100 ₽");
    const code = "RC-" + Math.floor(1000 + Math.random()*9000);
    const phone = "+79600738559";

    tg.showPopup({title:"Данные для оплаты",message:`<div style="padding:20px;text-align:center;">
      <div class="copy-block" onclick="copyToClipboard('${amount}', this.querySelector('.copy-hint'))"><div class="copy-text">${amount} ₽</div><div class="copy-hint">Нажми, чтобы скопировать</div></div>
      <div class="copy-block" onclick="copyToClipboard('${phone}', this.querySelector('.copy-hint'))"><div class="copy-text">${phone}</div><div class="copy-hint">Нажми, чтобы скопировать</div></div>
      <div class="copy-block" onclick="copyToClipboard('${code}', this.querySelector('.copy-hint'))"><div class="copy-text">${code}</div><div class="copy-hint">Нажми, чтобы скопировать</div></div>
      <p style="margin-top:20px;color:#ccc;">Пришли чек + код в @RapiHappy</p>
      <button onclick="confirmTopUpFinal(${amount})" style="width:100%;padding:18px;background:#00ff88;color:black;border:none;border-radius:20px;font-weight:900;margin-top:20px;cursor:pointer;">ОТПРАВИТЬ ЗАЯВКУ</button>
    </div>`,buttons:[{type:"close"}]});
  }

  function confirmTopUpFinal(amount) {
    tg.showConfirm(`Точно пополнить на ${amount} ₽?`, ok => {
      if (ok) tg.showAlert("Заявка отправлена! Ожидай зачисления.");
    });
  }

  // === ВЫВОД ===
  function startWithdraw() {
    tg.showPopup({title:"Вывод средств",message:`<div style="padding:20px;text-align:center;">
      <p style="color:#aaa;">Доступно: <b style="color:#00ff88;">${userBalance.toLocaleString()} ₽</b></p>
      <input type="number" id="withdrawSum" placeholder="от 100 ₽" style="width:100%;padding:18px;margin:15px 0;background:rgba(0,0,0,0.7);border:3px solid #ff3366;border-radius:20px;color:white;font-size:18px;text-align:center;">
      <button onclick="showWithdrawDetails()" style="width:100%;padding:18px;background:#ff3366;color:white;border:none;border-radius:20px;font-weight:900;margin-top:10px;cursor:pointer;">ДАЛЕЕ</button>
    </div>`,buttons:[{type:"close"}]});
  }

  function showWithdrawDetails() {
    const amount = parseInt(document.getElementById('withdrawSum').value);
    if (!amount || amount < 100) return tg.showAlert("Минимум 100 ₽");
    if (amount > userBalance) return tg.showAlert("Недостаточно средств!");

    tg.showPopup({title:"Реквизиты",message:`<div style="padding:20px;">
      <input type="text" id="wName" placeholder="Имя / Ник" style="width:100%;padding:18px;margin:10px 0;background:rgba(0,0,0,0.7);border:3px solid #ff3366;border-radius:20px;color:white;font-size:16px;">
      <input type="text" id="wCard" placeholder="Карта / Телефон" style="width:100%;padding:18px;margin:10px 0;background:rgba(0,0,0,0.7);border:3px solid #ff3366;border-radius:20px;color:white;font-size:16px;">
      <input type="text" id="wBank" placeholder="Банк (если карта)" style="width:100%;padding:18px;margin:10px 0;background:rgba(0,0,0,0.7);border:3px solid #ff3366;border-radius:20px;color:white;font-size:16px;">
      <button onclick="confirmWithdrawFinal(${amount})" style="width:100%;padding:18px;background:#ff3366;color:white;border:none;border-radius:20px;font-weight:900;margin-top:20px;cursor:pointer;">ОТПРАВИТЬ ЗАЯВКУ</button>
    </div>`,buttons:[{type:"close"}]});
  }

  function confirmWithdrawFinal(amount) {
    const name = document.getElementById('wName').value.trim();
    const card = document.getElementById('wCard').value.trim();
    const bank = document.getElementById('wBank').value.trim();
    if (!name || !card) return tg.showAlert("Заполните все поля!");

    tg.showConfirm(`Точно вывести ${amount.toLocaleString()} ₽?`, ok => {
      if (ok) {
        tg.sendData(JSON.stringify({action:"withdraw", amount, name, card, bank}));
        userBalance -= amount;
        document.getElementById('user-balance').innerText = userBalance.toLocaleString() + ' ₽';
        tg.showAlert("Заявка отправлена!");
      }
    });
  }

  // === ЗАДАНИЯ ===
  function autoRoundBudget() {
    clearTimeout(roundTimeout);
    roundTimeout = setTimeout(() => {
      const type = document.getElementById('task-type').value;
      if (!type) return;
      let budget = parseInt(document.getElementById('task-budget').value) || 0;
      const min = minBudget[type];
      const price = prices[type];
      if (budget < min) { document.getElementById('task-budget').value = min; budget = min; }
      const rounded = Math.floor(budget / price) * price;
      if (rounded >= min) document.getElementById('task-budget').value = rounded;
      updateBudgetInfo();
    }, 800);
  }

  function updateBudgetInfo() {
    const type = document.getElementById('task-type').value;
    const budget = parseInt(document.getElementById('task-budget').value) || 0;
    if (!type || budget < minBudget[type]) {
      document.getElementById('budget-result').innerHTML = `Минимум ${minBudget[type]} ₽`;
      return;
    }
    const count = Math.floor(budget / prices[type]);
    const real = count * prices[type];
    document.getElementById('budget-result').innerHTML = `За <b style="color:#00ff88;font-size:26px;">${real} ₽</b> будет выполнено<br><b style="font-size:38px;color:#ffd700;">${count}</b> ${type==='telegram'?'подписок':'отзывов'}`;
  }

  function setBudget(btn, amount) {
    document.getElementById('task-budget').value = amount;
    document.querySelectorAll('.price-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    updateBudgetInfo();
  }

  function createTask() {
    const title = document.getElementById('task-title').value.trim();
    const link = document.getElementById('task-link').value.trim();
    const type = document.getElementById('task-type').value;
    const budget = parseInt(document.getElementById('task-budget').value);
    if (!title || !link || !type || budget < minBudget[type]) return tg.showAlert("Заполните всё правильно!");
    if (!link.startsWith('http')) return tg.showAlert("Ссылка должна начинаться с http:// или https://");

    const count = Math.floor(budget / prices[type]);
    const real = count * prices[type];

    tg.showConfirm(`Опубликовать ${count} заданий за ${real} ₽?`, ok => {
      if (ok) {
        tg.sendData(JSON.stringify({action:"create_task", title, link, type, budget: real, count}));
        tg.showAlert("Задание опубликовано!");
        document.getElementById('create-form').classList.remove('active');
      }
    });
  }

  function switchRole(r) {
    document.querySelectorAll('.role-btn').forEach(b => b.classList.remove('active'));
    event.target.classList.add('active');
    document.getElementById('employer-mode').style.display = r==='employer'?'block':'none';
    document.getElementById('worker-mode').style.display = r==='worker'?'block':'none';
  }

  function showPage(p) {
    document.getElementById('main-page').style.display = p==='main'?'block':'none';
    document.getElementById('profile-page').style.display = p==='profile'?'block':'none';
    document.querySelectorAll('.nav-btn').forEach((b,i)=>b.classList.toggle('active', i===(p==='profile'?1:0)));
  }

  function centerFilter(btn) {
    document.querySelectorAll('.filter-btn').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    btn.scrollIntoView({behavior:'smooth',block:'nearest',inline:'center'});
  }
</script>
</body>
</html>
