<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ReviewCash — WebApp</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
<style>
  :root{
    --bg:#0a0014;--glass:rgba(15,10,45,0.98);--neon:#00ffff;--green:#00ff88;--gold:#ffd700;--muted:#88c0d0;--red:#ff3366;
  }
  *{box-sizing:border-box}
  body{background:linear-gradient(135deg,#0a0014,#001133);color:#e6fbff;font-family:Inter,system-ui,-apple-system;padding:14px;min-height:100vh;margin:0;}
  .container{max-width:420px;margin:0 auto;}
  .header{text-align:center;margin:18px 0;}
  h1{font-size:34px;background:linear-gradient(90deg,#00ffff,#00ff88);-webkit-background-clip:text;color:transparent;margin:0;}
  .role-switch{display:flex;background:rgba(20,20,50,0.9);border:3px solid rgba(0,255,255,0.12);border-radius:32px;padding:6px;gap:6px;margin:12px 0;}
  .role-btn{flex:1;padding:10px;border-radius:26px;text-align:center;font-weight:900;cursor:pointer;color:var(--muted);background:transparent;border:none}
  .role-btn.active{background:linear-gradient(135deg,var(--neon),var(--green));color:#001;box-shadow:0 10px 40px rgba(0,255,255,0.06)}
  .create-form{background:var(--glass);border:2px solid rgba(0,255,255,0.06);padding:14px;border-radius:14px;margin-bottom:12px;display:none}
  .create-form.active{display:block}
  input,select,textarea{width:100%;padding:12px;border-radius:12px;background:#001;border:1px solid rgba(255,255,255,0.04);color:#fff;margin-top:10px}
  .price-buttons{display:flex;gap:8px;overflow-x:auto;padding:10px 0}
  .price-btn{padding:10px 14px;border-radius:12px;background:rgba(0,255,255,0.04);border:1px solid rgba(0,255,255,0.06);cursor:pointer;font-weight:900}
  .price-btn.active{background:linear-gradient(45deg,var(--neon),var(--green));color:#001;transform:scale(1.05)}
  .btn-primary{background:linear-gradient(45deg,var(--neon),var(--green));color:#001;flex:1;padding:12px;border-radius:12px;border:none;font-weight:900;cursor:pointer}
  .btn-outline{padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--muted);cursor:pointer}
  .card{background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));padding:12px;border-radius:12px;border:1px solid rgba(0,255,255,0.06);margin-bottom:12px;}
  .task-title{font-weight:900;font-size:18px;margin-bottom:6px;}
  .task-meta{color:var(--muted);font-size:13px;margin-bottom:8px;}
  .filter-bar{display:flex;gap:8px;overflow-x:auto;padding:8px 0;margin:10px 0}
  .filter-btn{padding:10px 12px;border-radius:12px;background:rgba(0,255,255,0.04);border:1px solid rgba(0,255,255,0.06);cursor:pointer;color:#fff;font-weight:900}
  .filter-btn.active{background:linear-gradient(45deg,var(--neon),var(--green));color:#001}
  .small{font-size:13px;color:var(--muted)}
  .instr{background:rgba(0,0,0,0.35);padding:10px;border-radius:8px;margin-top:8px;font-size:14px;color:#e6fbff}
  .bottom-nav{position:fixed;left:16px;right:16px;bottom:18px;background:rgba(15,15,45,0.98);backdrop-filter:blur(20px);border-radius:40px;padding:10px;border:3px solid rgba(0,255,255,0.06);display:flex;gap:8px;box-shadow:0 30px 80px rgba(0,0,0,0.7)}
  .nav-btn{flex:1;padding:12px;border-radius:26px;border:none;background:transparent;color:var(--muted);font-weight:900;cursor:pointer}
  .nav-btn.active{background:linear-gradient(45deg,var(--neon),var(--green));color:#001;transform:translateY(-6px)}
  .rc-modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.6);display:flex;align-items:center;justify-content:center;z-index:4000}
  .rc-modal{width:92%;max-width:480px;background:linear-gradient(180deg,#071426,#081a33);padding:16px;border-radius:12px;border:2px solid rgba(0,255,255,0.06);color:#e6fbff;position:relative}
  .rc-modal .rc-close{position:absolute;right:12px;top:8px;cursor:pointer;font-weight:900;color:#fff}
  .profile-avatar{width:120px;height:120px;border-radius:50%;border:6px solid var(--neon);object-fit:cover;background:#001}
  .requests-list .card{padding:8px;margin-bottom:8px}
</style>
</head>
<body>
  <div class="container" id="main-page">
    <div class="header"><h1>REVIEWCASH</h1></div>

    <div class="role-switch" role="tablist" aria-label="Роль">
      <button class="role-btn active" data-role="employer" aria-pressed="true">РАБОТОДАТЕЛЬ</button>
      <button class="role-btn" data-role="worker" aria-pressed="false">ИСПОЛНИТЕЛЬ</button>
    </div>

    <div id="employer-panel">
      <div style="text-align:center;margin-bottom:10px;">
        <button id="create-task-toggle" class="btn-outline">+ СОЗДАТЬ ЗАДАНИЕ</button>
      </div>

      <div class="create-form" id="create-form" aria-hidden="true">
        <input id="task-title" placeholder="Название задания">
        <input id="task-link" placeholder="Ссылка на отзыв / канал">
        <select id="task-type" aria-label="Тип задания">
          <option value="">Выберите тип</option>
          <option value="yandex">Яндекс Отзыв — 100 ₽</option>
          <option value="google">Google Отзыв — 65 ₽</option>
          <option value="telegram">Telegram Подписка — 10 ₽</option>
        </select>
        <input id="task-budget" type="number" placeholder="Бюджет (макс. 15 000 ₽)" min="100" max="15000">
        <div class="price-buttons" id="priceButtons" aria-hidden="false">
          <button class="price-btn" data-amount="1000">1 000 ₽</button>
          <button class="price-btn" data-amount="3000">3 000 ₽</button>
          <button class="price-btn" data-amount="5000">5 000 ₽</button>
          <button class="price-btn" data-amount="10000">10 000 ₽</button>
          <button class="price-btn" data-amount="15000">15 000 ₽</button>
        </div>
        <div style="margin-top:8px;font-weight:900;color:var(--gold)" id="budget-result">Выберите тип и бюджет</div>
        <div style="display:flex;gap:8px;margin-top:12px;">
          <button id="publish-task" class="btn-primary">ОПУБЛИКОВАТЬ</button>
          <button id="cancel-create" class="btn-outline">ОТМЕНИТЬ</button>
        </div>
      </div>
    </div>

    <div id="worker-panel" style="display:none">
      <div class="filter-bar" id="filterBar" role="toolbar" aria-label="Фильтр">
        <button class="filter-btn active" data-filter="all">ВСЕ</button>
        <button class="filter-btn" data-filter="yandex">ЯНДЕКС</button>
        <button class="filter-btn" data-filter="google">GOOGLE</button>
        <button class="filter-btn" data-filter="telegram">TG</button>
      </div>

      <div style="margin:8px 0;display:flex;gap:8px;align-items:center;">
        <input id="searchInput" class="search" placeholder="Поиск заданий">
        <button id="refreshBtn" class="btn-outline">Обновить</button>
      </div>

      <div id="tasksList" aria-live="polite"></div>
    </div>

  </div>

  <div class="container" id="profile-page" style="display:none;">
    <div class="card" style="position:relative;">
      <div style="position:absolute;right:12px;top:12px;">
        <button id="supportBtn" class="btn-outline" title="Поддержка"><i class="fas fa-headset"></i></button>
      </div>
      <div style="display:flex;flex-direction:column;align-items:center;text-align:center;padding:18px;">
        <img id="user-avatar" class="profile-avatar" src="" alt="avatar">
        <div id="user-name" style="font-weight:900;font-size:20px;margin-top:10px">Пользователь</div>
        <div id="user-username" class="small" style="margin-bottom:12px">@username</div>
        <div class="small" style="margin-bottom:6px">Доступно для вывода</div>
        <div class="small" id="user-balance" style="font-size:28px;font-weight:900;color:var(--green)">0 ₽</div>
        <div style="width:100%;margin-top:12px;">
          <button id="topup-btn" class="btn-primary" style="width:100%;margin-bottom:8px;padding:12px">ПОПОЛНИТЬ БАЛАНС</button>
          <button id="withdraw-btn" class="btn-outline" style="width:100%;padding:12px">ВЫВЕСТИ СРЕДСТВА</button>
        </div>
      </div>
      <div style="margin-top:12px;">
        <div class="small">Мои заявки</div>
        <div id="my-requests" class="requests-list" style="margin-top:8px"></div>
      </div>
    </div>
  </div>

  <div class="bottom-nav" role="navigation" aria-label="Навигация">
    <button class="nav-btn active" data-page="main">Задания</button>
    <button class="nav-btn" data-page="profile">Профиль</button>
  </div>

<script>
/* Socket client */
(function(){
  function qs(name){ return new URLSearchParams(location.search).get(name); }
  const token = qs('token') || '';
  // connect if we have socket.io loaded
  if (typeof io !== 'undefined') {
    const socket = io({ auth: { token: token }, transports: ['websocket'] });
    socket.on('connect', ()=> console.log('socket connected', socket.id));
    socket.on('connect_error', (err)=> console.error('socket error', err));
    socket.on('new_topup_user', (d)=> { alert('Заявка на пополнение принята'); try{ renderMyRequests(); }catch(e){} });
    socket.on('new_work_user', (d)=> { alert('Ваша заявка принята в очередь проверки'); try{ renderMyRequests(); }catch(e){} });
  }
})();

/* The rest of the UI JS (omitted here for brevity) is the same as the index.html content provided earlier.
   For full client logic and handlers see the index.html block sent in the conversation. */
</script>
</body>
</html>
