<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>üõ† ReviewCash ‚Äî –ê–¥–º–∏–Ω–∫–∞</title>
<!-- –°—Ç–∏–ª—å -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet"/>
<style>
body { font-family:'Inter',sans-serif; background:#111; color:#eee; margin:0; }
.header { display:flex; justify-content:space-between; align-items:center; padding:16px; background:#222; }
.btn { padding:10px 14px; border-radius:12px; border:none; background:#38bdf8; color:#fff; cursor:pointer; font-weight:600; transition:background 0.2s; margin-top:10px; }
.btn:hover { background:#4ccaff; }
section { padding:16px; display:none; }
section.active { display:block; }
table { width:100%; border-collapse: collapse; }
th, td { padding:8px; border-bottom:1px solid #444; font-size:13px; }
th { background:#333; font-weight:600; }
</style>
</head>
<body>
<div class="header">
<h1>üõ† ReviewCash ‚Äî –ê–¥–º–∏–Ω–∫–∞</h1>
<div>
<button class="btn" id="btnRefresh">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
<button class="btn" id="btnExport">üìÅ –≠–∫—Å–ø–æ—Ä—Ç</button>
</div>
</div>
<!-- –º–µ–Ω—é -->
<div style="display:flex; gap:8px; padding:16px;">
  <button class="btn" data-tab="dashboard">üìä –ü–∞–Ω–µ–ª—å</button>
  <button class="btn" data-tab="users">üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</button>
  <button class="btn" data-tab="tasks">üìù –ó–∞–¥–∞–Ω–∏—è</button>
  <button class="btn" data-tab="topups">üí∞ –ü–æ–ø–æ–ª–Ω–µ–Ω–∏—è</button>
  <button class="btn" data-tab="withdraws">üí∏ –í—ã–≤–æ–¥—ã</button>
  <button class="btn" data-tab="types">üß© –¢–∏–ø—ã</button>
</div>

<!-- –†–∞–∑–¥–µ–ª—ã -->
<section id="tab-dashboard" class="active">
<h2>–û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
<div>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: <span id="stats-users">-</span></div>
<div>–û–±—â–∏–π –¥–æ—Ö–æ–¥: <span id="stats-revenue">-</span></div>
<div>–ó–∞–¥–∞—á: <span id="stats-tasks">-</span></div>
<div>–í –æ–±—Ä–∞–±–æ—Ç–∫–µ: <span id="stats-processing">-</span></div>
</section>

<section id="tab-users">
<h2>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h2>
<table>
<thead><tr><th>ID</th><th>–ò–º—è</th><th>–ë–∞–ª–∞–Ω—Å</th><th>–ó–∞–¥–∞—á–∏</th></tr></thead>
<tbody id="users-body"></tbody>
</table>
</section>

<section id="tab-tasks">
<h2>–ó–∞–¥–∞–Ω–∏—è</h2>
<table>
<thead><tr><th>ID</th><th>–¢–∏–ø</th><th>–ó–∞–≥–æ–ª–æ–≤–æ–∫</th><th>–í—ã–ø–æ–ª–Ω–µ–Ω–æ/–û–±—â–µ–µ</th><th>–¶–µ–Ω–∞</th></tr></thead>
<tbody id="tasks-body"></tbody>
</table>
</section>

<section id="tab-topups">
<h2>–ü–æ–ø–æ–ª–Ω–µ–Ω–∏—è</h2>
<table>
<thead><tr><th>ID</th><th>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</th><th>–°—É–º–º–∞</th><th>–°—Ç–∞—Ç—É—Å</th></tr></thead>
<tbody id="topups-body"></tbody>
</table>
</section>

<section id="tab-withdraws">
<h2>–í—ã–≤–æ–¥—ã</h2>
<table>
<thead><tr><th>ID</th><th>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</th><th>–°—É–º–º–∞</th><th>–°—Ç–∞—Ç—É—Å</th></tr></thead>
<tbody id="withdraws-body"></tbody>
</table>
</section>

<section id="tab-types">
<h2>–¢–∏–ø—ã –∑–∞–¥–∞—á</h2>
<button onclick="createType()">–°–æ–∑–¥–∞—Ç—å —Ç–∏–ø</button>
<table>
<thead><tr><th>ID</th><th>–ù–∞–∑–≤–∞–Ω–∏–µ</th><th>–¶–µ–Ω–∞</th></tr></thead>
<tbody id="types-body"></tbody>
</table>
</section>

<script>
const tabs=document.querySelectorAll('[data-tab]');
const sections={
  dashboard: document.getElementById('tab-dashboard'),
  users: document.getElementById('tab-users'),
  tasks: document.getElementById('tab-tasks'),
  topups: document.getElementById('tab-topups'),
  withdraws: document.getElementById('tab-withdraws'),
  types: document.getElementById('tab-types')
}
let currentTab='dashboard';
tabs.forEach(t => {
  t.onclick= ()=>{
    Object.values(sections).forEach(s=>s.classList.remove('active'));
    sections[t.dataset['tab']].classList.add('active');
    currentTab=t.dataset['tab'];
    loadTab(currentTab);
  }
});
document.getElementById('btnRefresh').onclick=()=>loadTab(currentTab);
document.getElementById('btnExport').onclick=()=>{ window.location='/api/admin/export/'+currentTab; }

// –ó–∞–≥—Ä—É–∑–∫–∞ –≤–∫–ª–∞–¥–æ–∫
function loadTab(tab) {
  switch(tab) {
    case 'dashboard': loadDashboard(); break;
    case 'users': loadUsers(); break;
    case 'tasks': loadTasks(); break;
    case 'topups': loadTopups(); break;
    case 'withdraws': loadWithdraws(); break;
    case 'types': loadTypes(); break;
  }
}
// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
function loadDashboard() {
  fetch('/api/admin/dashboard').then(r=>r.json()).then(d=>{
    document.getElementById('stats-users').innerText= d.data.usersCount;
    document.getElementById('stats-revenue').innerText= d.data.totalRevenue+' ‚ÇΩ';
    document.getElementById('stats-tasks').innerText= d.data.tasksCount;
    document.getElementById('stats-processing').innerText= d.data.pendingCount;
  });
}
function loadUsers() {
  fetch('/api/admin/users').then(r=>r.json()).then(d=>{
    const tbody= document.getElementById('users-body');
    tbody.innerHTML='';
    d.users.forEach(u=>{
      tbody.innerHTML+=`<tr><td>${u.id}</td><td>${u.first_name}</td><td>${u.balance} ‚ÇΩ</td><td>${u.tasks_done || 0}</td></tr>`;
    });
  });
}
function loadTasks() {
  fetch('/api/admin/tasks').then(r=>r.json()).then(d=>{
    const tbody= document.getElementById('tasks-body');
    tbody.innerHTML='';
    d.tasks.forEach(t=>{
      tbody.innerHTML+=`<tr><td>${t.id}</td><td>${t.type_id}</td><td>${t.title}</td><td>${t.done}/${t.count}</td><td>${t.unit_price} ‚ÇΩ</td></tr>`;
    });
  });
}
function loadTopups() {
  fetch('/api/admin/topups').then(r=>r.json()).then(d=>{
    const tbody= document.getElementById('topups-body');
    tbody.innerHTML='';
    d.items.forEach(t=>{
      tbody.innerHTML+=`<tr><td>${t.id}</td><td>${t.user_id}</td><td>${t.amount} ‚ÇΩ</td><td>${t.status}</td></tr>`;
    });
  });
}
function loadWithdraws() {
  fetch('/api/admin/withdraws').then(r=>r.json()).then(d=>{
    const tbody= document.getElementById('withdraws-body');
    tbody.innerHTML='';
    d.items.forEach(w=>{
      tbody.innerHTML+=`<tr><td>${w.id}</td><td>${w.user_id}</td><td>${w.amount} ‚ÇΩ</td><td>${w.status}</td></tr>`;
    });
  });
}
function loadTypes() {
  fetch('/api/admin/types').then(r=>r.json()).then(d=>{
    const tbody= document.getElementById('types-body');
    tbody.innerHTML='';
    d.types.forEach(t=>{
      tbody.innerHTML+=`<tr><td>${t.id}</td><td>${t.name}</td><td>${t.price} ‚ÇΩ</td></tr>`;
    });
  });
}
function createType() {
  const name=prompt("–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ");
  const price=prompt("–í–≤–µ–¥–∏—Ç–µ —Ü–µ–Ω—É");
  if(name && price && !isNaN(price)){
    fetch('/api/admin/types',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({name,price})})
    .then(r=>r.json()).then(d=>{if(d.ok){loadTypes();}});
  }
}
// –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
loadTab(currentTab);
setInterval(()=>loadTab(currentTab), 60000);
</script>
</body>
</html>
