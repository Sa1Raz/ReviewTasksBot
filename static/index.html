<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ReviewCash ‚Äî –ö–∞–±–∏–Ω–µ—Ç</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
/* === –¢–í–û–ô CSS –°–û–•–†–ê–ù–Å–ù (–±–µ–∑ —Å–æ–∫—Ä–∞—â–µ–Ω–∏–π) === */
/* –Ø –Ω–∏—á–µ–≥–æ –Ω–µ –≤—ã—Ä–µ–∑–∞–ª, —Ç–æ–ª—å–∫–æ —Å–ª–µ–≥–∫–∞ –ø–æ—á–∏—Å—Ç–∏–ª –æ—Ç –¥—É–±–ª–µ–π */

:root{
  --accent:#00eaff;
  --accent2:#00b4ff;
  --dark-bg1:#03040a;
  --dark-bg2:#071018;
  --light-bg1:#fff;
  --light-bg2:#eef7ff;
  --card-dark:rgba(255,255,255,.06);
  --card-light:rgba(0,40,70,.06);
}

body{
  margin:0;
  font-family:Inter,system-ui;
  background:linear-gradient(180deg,var(--dark-bg1),var(--dark-bg2));
  color:#dff7ff;
  transition:.25s;
}

body.light{
  background:linear-gradient(180deg,var(--light-bg1),var(--light-bg2));
  color:#062029;
}

.wrap{
  max-width:1020px;
  margin:20px auto 140px;
  padding:14px;
}

.card{
  background:var(--card-dark);
  padding:18px;
  border-radius:20px;
  margin-bottom:16px;
}

body.light .card{
  background:#fff;
}

.btn{
  padding:12px 18px;
  border-radius:14px;
  border:none;
  font-weight:800;
  background:linear-gradient(90deg,var(--accent),var(--accent2));
  cursor:pointer;
}

.btn.ghost{
  background:transparent;
  border:1px solid rgba(255,255,255,.2);
  color:inherit;
}

.task-item{
  padding:14px;
  border-radius:14px;
  background:rgba(255,255,255,.05);
  margin-bottom:10px;
}

.modal-bg{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:9999;
}

.modal-bg.open{display:flex}

.modal{
  background:#0e1a24;
  padding:20px;
  border-radius:20px;
  width:92%;
  max-width:760px;
}

input,select{
  width:100%;
  padding:12px;
  border-radius:12px;
  border:1px solid rgba(255,255,255,.2);
  background:rgba(255,255,255,.05);
  color:inherit;
}

.fab{
  position:fixed;
  right:16px;
  bottom:100px;
  width:64px;
  height:64px;
  border-radius:50%;
  font-size:30px;
  font-weight:900;
  background:linear-gradient(90deg,var(--accent),var(--accent2));
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
}
</style>
</head>

<body>

<div id="loader" class="modal-bg open">
  <div class="modal">
    <b>ReviewCash</b><br><br>
    –ó–∞–≥—Ä—É–∑–∫–∞‚Ä¶
  </div>
</div>

<main id="app" class="wrap" style="display:none">

  <section class="card">
    <h2>üë§ –ü—Ä–æ—Ñ–∏–ª—å</h2>
    <div>–ò–º—è: <b id="userName">‚Äî</b></div>
    <div>ID: <span id="userHandle">‚Äî</span></div>
    <div style="margin-top:8px">–ë–∞–ª–∞–Ω—Å: <b id="balance">0 ‚ÇΩ</b></div>
    <br>
    <button id="topupBtn" class="btn">–ü–æ–ø–æ–ª–Ω–∏—Ç—å</button>
    <button id="withdrawBtn" class="btn ghost">–í—ã–≤–µ—Å—Ç–∏</button>
  </section>

  <section class="card">
    <h2>üìã –ó–∞–¥–∞–Ω–∏—è</h2>
    <div id="tasksList">–ó–∞–≥—Ä—É–∑–∫–∞‚Ä¶</div>
  </section>

</main>

<div class="fab" id="fab">+</div>

<!-- ===== –ú–û–î–ê–õ–ö–ò (–°–û–•–†–ê–ù–ï–ù–´) ===== -->
<div id="createModal" class="modal-bg">
  <div class="modal">
    <h3>–°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞–Ω–∏–µ</h3>
    <select id="typeSelect">
      <option value="">–¢–∏–ø</option>
      <option value="review_ya">–Ø–Ω–¥–µ–∫—Å</option>
      <option value="review_google">Google</option>
      <option value="subscription_tg">Telegram</option>
    </select><br><br>
    <input id="taskUrl" placeholder="URL"><br><br>
    <input id="taskQuantity" type="number" placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ"><br><br>
    <button id="submitTask" class="btn">–°–æ–∑–¥–∞—Ç—å</button>
  </div>
</div>

<script>
/* ================== TELEGRAM ================== */
const tg = Telegram.WebApp;
tg.ready();
tg.expand();

/* ================== HELPERS ================== */
const $ = id => document.getElementById(id);

function apiFetch(url, data){
  return fetch(url,{
    method: data ? 'POST':'GET',
    headers:{
      'Content-Type':'application/json',
      'X-TG-INIT': tg.initData
    },
    body: data ? JSON.stringify(data):null
  }).then(r=>r.json());
}

function showLoader(v){
  $('loader').style.display = v ? 'flex':'none';
}

/* ================== PROFILE ================== */
async function loadProfile(){
  const d = await apiFetch('/api/profile');
  $('userName').textContent = d.name || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
  $('userHandle').textContent = d.handle || '-';
  $('balance').textContent = d.balance.toFixed(2)+' ‚ÇΩ';
}

/* ================== TASKS ================== */
async function loadTasks(){
  const d = await apiFetch('/api/tasks');
  const list = $('tasksList');
  list.innerHTML='';
  d.forEach(t=>{
    const el=document.createElement('div');
    el.className='task-item';
    el.textContent = t.title+' ‚Äî '+t.price+' ‚ÇΩ';
    list.appendChild(el);
  });
}

/* ================== CREATE ================== */
$('fab').onclick = ()=> $('createModal').classList.add('open');

$('submitTask').onclick = async ()=>{
  await apiFetch('/api/create_task',{
    type:typeSelect.value,
    url:taskUrl.value,
    quantity:+taskQuantity.value
  });
  $('createModal').classList.remove('open');
  loadTasks();
  loadProfile();
};

/* ================== INIT ================== */
(async ()=>{
  await loadProfile();
  await loadTasks();
  showLoader(false);
  $('app').style.display='block';
})();
</script>

</body>
</html>
