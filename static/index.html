<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ReviewCash — Кабинет (улучшено)</title>

  <!-- Socket.IO (CDN) -->
  <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    :root{--accent1:#00e7c0;--accent2:#06b6d4;--muted:#6f8b95;--radius:14px}
    body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto;background:linear-gradient(180deg,#f6fbff,#ffffff);color:#062029;margin:0;min-height:100vh}
    body.dark{background:linear-gradient(180deg,#020712,#04111a);color:#dff7ff}
    .wrap{max-width:980px;margin:18px auto;padding:18px}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.9), rgba(255,255,255,0.85));padding:14px;border-radius:var(--radius);box-shadow:0 12px 40px rgba(8,20,30,0.06);border:1px solid rgba(0,0,0,0.04)}
    body.dark .card{background:linear-gradient(180deg, rgba(6,12,18,0.7), rgba(8,14,20,0.6));border:1px solid rgba(255,255,255,0.04)}
    .header{display:flex;gap:12px;align-items:center}
    .logo{width:56px;height:56px;border-radius:12px;background:linear-gradient(90deg,var(--accent1),var(--accent2));display:flex;align-items:center;justify-content:center;font-weight:900;color:#001}
    .title{font-weight:900}
    .small{font-size:13px;color:var(--muted)}
    .loader{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg,rgba(0,0,0,0.45),rgba(0,0,0,0.65));z-index:999;flex-direction:column;color:white}
    .loader.hidden{display:none}
    .profile-row{display:flex;gap:12px;align-items:center}
    .avatar{width:84px;height:84px;border-radius:50%;overflow:hidden;border:3px solid rgba(255,255,255,0.06)}
    .avatar img{width:100%;height:100%;object-fit:cover}
    .balance{font-size:28px;font-weight:900;background:linear-gradient(90deg,var(--accent1),var(--accent2));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
    .row{display:flex;gap:8px;align-items:center}
    .btn{padding:10px 12px;border-radius:12px;border:1px solid rgba(0,0,0,0.06);cursor:pointer;font-weight:800;background:linear-gradient(90deg,var(--accent1),var(--accent2));color:#001}
    .btn.ghost{background:transparent;border:1px solid rgba(0,0,0,0.08);box-shadow:none;color:inherit}
    .btn.small{padding:8px 10px;font-weight:700}
    .fab{position:fixed;right:20px;bottom:110px;width:64px;height:64px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:900;z-index:60}
    .tabbar{position:fixed;left:50%;transform:translateX(-50%);bottom:18px;background:linear-gradient(180deg,rgba(255,255,255,0.96),rgba(255,255,255,0.9));padding:8px;border-radius:999px;display:flex;gap:8px;border:1px solid rgba(0,0,0,0.05)}
    body.dark .tabbar{background:linear-gradient(180deg,rgba(2,6,11,0.9),rgba(3,9,15,0.9));border:1px solid rgba(255,255,255,0.04)}
    .nav-item{padding:10px 14px;border-radius:999px;cursor:pointer;font-weight:800;color:var(--muted);border:1px solid rgba(0,0,0,0.04)}
    .nav-item.active{background:linear-gradient(90deg,var(--accent1),var(--accent2));color:#001}
    .modal-bg{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.45);z-index:999}
    .modal-bg.open{display:flex}
    .modal{width:94%;max-width:720px;background:var(--panel,white);padding:16px;border-radius:14px;box-shadow:0 18px 50px rgba(0,0,0,0.25)}
    input,textarea,select{width:100%;padding:10px;border-radius:10px;border:1px solid rgba(0,0,0,0.06);background:transparent;color:inherit}
    .task-item{display:flex;justify-content:space-between;align-items:center;padding:12px;border-radius:12px;margin-bottom:8px;background:rgba(0,0,0,0.02)}
    body.dark .task-item{background:rgba(255,255,255,0.02)}
    .url-check{display:inline-block;width:18px;height:18px;border:3px solid var(--accent1);border-top:3px solid transparent;border-radius:50%;animation:spin .9s linear infinite;vertical-align:middle;margin-left:8px}
    @keyframes spin{to{transform:rotate(360deg)}}
    .url-status{margin-left:10px;font-weight:800}
    .sr-only{position:absolute;left:-9999px}
  </style>
</head>
<body>
  <div id="loader" class="loader">
    <div style="font-weight:900;font-size:28px">ReviewCash</div>
    <div style="opacity:0.95;margin-top:8px">Загрузка приложения…</div>
  </div>

  <div class="wrap" id="app" style="display:none">
    <div class="header card" style="align-items:center">
      <div class="logo">RC</div>
      <div style="flex:1">
        <div class="title">Панель — ReviewCash</div>
        <div class="small">Удобный личный кабинет: задания, пополнение и вывод</div>
      </div>
      <div class="row">
        <button id="themeToggle" class="btn small ghost">Тема</button>
      </div>
    </div>

    <div id="profileCard" class="card">
      <div class="profile-row">
        <div class="avatar"><img id="avatar" src="" alt="avatar"></div>
        <div style="flex:1">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div>
              <div id="userName" style="font-weight:900">Пользователь</div>
              <div id="userHandle" class="small">—</div>
            </div>
            <div style="text-align:right">
              <div class="small">Баланс</div>
              <div class="balance" id="balance">0 ₽</div>
            </div>
          </div>
          <div style="margin-top:12px" class="row">
            <button id="topupBtn" class="btn pulse">Пополнить</button>
            <button id="withdrawBtn" class="btn ghost">Вывести</button>
            <button id="supportBtn" class="btn ghost small">Поддержка</button>
          </div>
        </div>
      </div>
    </div>

    <div id="tasksCard" class="card">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div style="font-weight:900;font-size:18px">Задания</div>
        <div style="display:flex;gap:8px">
          <button id="filterAll" class="btn small ghost">Все</button>
          <button id="filterMine" class="btn small ghost">Мои</button>
        </div>
      </div>
      <div id="tasksList" style="margin-top:12px">
        <div class="small">Загрузка…</div>
      </div>
    </div>
  </div>

  <!-- FAB -->
  <div class="fab">
    <button id="createBtn" class="btn" title="Создать задание" style="width:64px;height:64px;border-radius:50%;">+</button>
  </div>

  <!-- Bottom nav -->
  <div class="tabbar">
    <div id="tabTasks" class="nav-item active">Задания</div>
    <div id="tabProfile" class="nav-item">Профиль</div>
  </div>

  <!-- Topup modal -->
  <div id="topupModal" class="modal-bg">
    <div class="modal card">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div style="font-weight:900">Пополнение</div>
        <button id="closeTopup" class="btn ghost small">✕</button>
      </div>
      <div class="small" style="margin-top:8px">Мин. 150 ₽</div>
      <div style="margin-top:10px;display:flex;gap:8px">
        <input id="topupAmount" type="number" min="150" value="150">
        <button id="createTopup" class="btn">Создать</button>
      </div>
      <div id="topupResult" style="margin-top:12px;display:none">
        <div class="small">Ссылка / QR</div>
        <img id="topupQR" style="max-width:220px;border-radius:8px;display:block;margin:8px 0">
        <input id="topupManual" readonly>
        <div style="margin-top:8px;display:flex;gap:8px">
          <a id="topupOpen" class="btn" target="_blank">Открыть</a>
          <button id="topupIpaid" class="btn ghost">Я оплатил</button>
        </div>
        <div id="topupMsg" class="small" style="margin-top:8px"></div>
      </div>
    </div>
  </div>

  <!-- Withdraw modal -->
  <div id="withdrawModal" class="modal-bg">
    <div class="modal card">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div style="font-weight:900">Вывод</div>
        <button id="closeWithdraw" class="btn ghost small">✕</button>
      </div>
      <div class="small" style="margin-top:8px">Мин. 300 ₽</div>
      <div style="margin-top:10px">
        <input id="wAmount" type="number" placeholder="Сумма">
        <input id="wName" type="text" placeholder="ФИО / Ник">
        <input id="wDetails" type="text" placeholder="Реквизиты (карта / СБП)">
        <div style="display:flex;gap:8px;margin-top:8px">
          <button id="sendWithdrawBtn" class="btn">Отправить</button>
          <button id="cancelWithdrawBtn" class="btn ghost">Отмена</button>
        </div>
        <div id="withdrawMsg" class="small" style="margin-top:8px"></div>
      </div>
    </div>
  </div>

  <!-- Create task modal -->
  <div id="createModal" class="modal-bg">
    <div class="modal card">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div style="font-weight:900">Создать задание</div>
        <button id="closeCreate" class="btn ghost small">✕</button>
      </div>
      <div style="margin-top:8px" class="small">Выберите тип и укажите ссылку</div>
      <div id="typesBox" style="display:flex;gap:8px;flex-wrap:wrap;margin-top:8px"></div>
      <div style="margin-top:10px">
        <input id="taskUrl" placeholder="https://...">
        <span id="urlChecker" style="display:none" class="url-check"></span><span id="urlStatus" class="url-status small"></span>
      </div>
      <div style="margin-top:8px;display:flex;gap:8px;align-items:center">
        <input id="taskQty" type="number" value="1" min="1" style="width:120px">
        <div id="unitPrice" class="small">Цена: —</div>
        <div id="totalPrice" style="margin-left:auto;font-weight:900">Всего: —</div>
      </div>
      <div style="margin-top:10px;display:flex;gap:8px">
        <button id="submitTaskBtn" class="btn">Создать</button>
        <button id="cancelCreateBtn" class="btn ghost">Отмена</button>
      </div>
      <div id="createMsg" class="small" style="margin-top:8px"></div>
    </div>
  </div>

<script>
(async ()=> {
  // Helpers
  const $ = s => document.querySelector(s);
  const $$ = s => Array.from(document.querySelectorAll(s));
  const loader = $('#loader'), app = document.getElementById('app');
  const avatar = $('#avatar'), userName = $('#userName'), userHandle = $('#userHandle'), balanceEl = $('#balance');
  const topupBtn = $('#topupBtn'), withdrawBtn = $('#withdrawBtn'), supportBtn = $('#supportBtn'), themeToggle = $('#themeToggle');
  const tabTasks = $('#tabTasks'), tabProfile = $('#tabProfile'), tabItems = $$('.nav-item');
  const tasksList = $('#tasksList'), filterAll = $('#filterAll'), filterMine = $('#filterMine');
  const createBtn = $('#createBtn'), createModal = $('#createModal'), closeCreate = $('#closeCreate'), cancelCreateBtn = $('#cancelCreateBtn');
  const typesBox = $('#typesBox'), taskUrl = $('#taskUrl'), urlChecker = $('#urlChecker'), urlStatus = $('#urlStatus'), taskQty = $('#taskQty');
  const unitPrice = $('#unitPrice'), totalPrice = $('#totalPrice'), submitTaskBtn = $('#submitTaskBtn'), createMsg = $('#createMsg');
  const topupModal = $('#topupModal'), closeTopup = $('#closeTopup'), createTopup = $('#createTopup'), topupAmount = $('#topupAmount'), topupResult = $('#topupResult'), topupQR = $('#topupQR'), topupManual = $('#topupManual'), topupOpen = $('#topupOpen'), topupIpaid = $('#topupIpaid'), topupMsg = $('#topupMsg');
  const withdrawModal = $('#withdrawModal'), closeWithdraw = $('#closeWithdraw'), cancelWithdrawBtn = $('#cancelWithdrawBtn'), sendWithdrawBtn = $('#sendWithdrawBtn'), wAmount = $('#wAmount'), wName = $('#wName'), wDetails = $('#wDetails'), withdrawMsg = $('#withdrawMsg');
  const tabbar = $('.tabbar');

  // user id from query or random
  const uid = (new URLSearchParams(location.search)).get('uid') || ('u' + Math.floor(Math.random()*999999));
  avatar.src = `https://api.dicebear.com/8.x/thumbs/svg?seed=${encodeURIComponent(uid)}`;

  // theme
  function applyTheme() {
    const t = localStorage.getItem('theme') || 'dark';
    document.body.classList.toggle('dark', t === 'dark');
  }
  applyTheme();
  themeToggle.addEventListener('click', () => {
    const next = document.body.classList.toggle('dark') ? 'dark' : 'light';
    localStorage.setItem('theme', next);
  });

  // tabs
  function showTab(name) {
    if (name === 'tasks') {
      $('#tasksCard').style.display = 'block';
      $('#profileCard').style.display = 'block'; // profile always visible in this layout; nav just scrolls
      tabTasks.classList.add('active'); tabProfile.classList.remove('active');
    } else {
      tabTasks.classList.remove('active'); tabProfile.classList.add('active');
      window.scrollTo({top:0,behavior:'smooth'});
    }
  }
  tabTasks.addEventListener('click', ()=>showTab('tasks'));
  tabProfile.addEventListener('click', ()=>showTab('profile'));

  // loader
  function hideLoader(){ loader.classList.add('hidden'); app.style.display='block'; }
  function showLoader(){ loader.classList.remove('hidden'); app.style.display='none'; }

  // data
  let tasks = [], types = [], selectedType = null;

  // socket (graceful)
  let socket;
  try {
    socket = io({transports:['websocket'], upgrade:false});
    socket.on('connect', ()=> console.log('socket connected'));
    socket.on('task_update', ()=> loadTasks());
    socket.on('user_update', d => { if (d && String(d.user_id) === String(uid) && typeof d.balance !== 'undefined') renderBalance(d.balance); });
    socket.on('connect_error', e => console.warn('socket err', e));
  } catch(e){ console.warn('socket init failed', e); }

  // load profile
  async function loadProfile() {
    try {
      const res = await fetch(`/api/profile_me?uid=${encodeURIComponent(uid)}`);
      const j = await res.json();
      if (j && j.user) {
        const u = j.user;
        userName.textContent = u.name || u.first_name || 'Пользователь';
        userHandle.textContent = u.username ? '@'+u.username : `ID: ${u.id||uid}`;
        renderBalance(u.balance || 0);
      } else renderBalance(0);
    } catch(e){ console.warn('profile err', e); renderBalance(0); }
  }
  function renderBalance(b) {
    balanceEl.textContent = (Number(b||0)).toLocaleString('ru-RU') + ' ₽';
    window.__USER_BALANCE = Number(b||0);
  }

  // load tasks
  async function loadTasks() {
    try {
      let res = await fetch('/api/tasks/list');
      if (!res.ok) res = await fetch('/api/tasks_public');
      const j = await res.json();
      tasks = j.tasks || j || [];
      renderTasks();
    } catch(e) { console.warn('tasks err', e); tasksList.innerHTML = '<div class="small">Не удалось загрузить задания</div>'; }
  }
  function renderTasks(filterMine=false) {
    const arr = filterMine ? tasks.filter(t => String(t.owner_uid) === String(uid)) : tasks;
    if (!arr.length) { tasksList.innerHTML = '<div class="small">Нет заданий</div>'; return; }
    tasksList.innerHTML = '';
    arr.forEach(t=> {
      const el = document.createElement('div'); el.className='task-item';
      el.innerHTML = `<div style="flex:1"><div style="font-weight:800">${escapeHtml(t.title||t.name||'Задание')}</div><div class="small">${escapeHtml(t.description||t.desc||'')}</div></div>
                      <div style="text-align:right"><div style="font-weight:900">${Number(t.unit_price||t.reward||0).toLocaleString('ru-RU')} ₽</div><div class="small">${(t.qty||1)} шт</div></div>`;
      tasksList.appendChild(el);
    });
  }

  // load types
  async function loadTypes() {
    try {
      let res = await fetch('/api/task_types');
      if (!res.ok) res = await fetch('/task_types.json');
      types = await res.json();
    } catch(e) {
      console.warn('types fallback', e);
      types = [
        {id:'ya_review',name:'Отзыв — Яндекс',unit_price:120,max_qty:500},
        {id:'gmaps_review',name:'Отзыв — Google',unit_price:65,max_qty:500},
        {id:'tg_sub',name:'Подписка — Telegram',unit_price:10,max_qty:100000}
      ];
    }
    renderTypes();
  }
  function renderTypes() {
    typesBox.innerHTML=''; selectedType = types[0] || null;
    types.forEach((t,idx)=>{
      const b = document.createElement('button');
      b.className='btn ghost small';
      b.type='button';
      b.innerHTML = `<div style="text-align:left">${escapeHtml(t.name)}<div class="small">${t.unit_price} ₽ / шт</div></div>`;
      b.addEventListener('click', ()=> {
        selectedType = t;
        $$('.btn.ghost.small').forEach(x=>x.classList.remove('active'));
        b.classList.add('active');
        updatePrices();
      });
      typesBox.appendChild(b);
      if (idx===0) b.classList.add('active');
    });
    updatePrices();
  }
  function updatePrices() {
    if (!selectedType) { unitPrice.textContent='Цена: —'; totalPrice.textContent='Всего: —'; return; }
    const qty = Number(taskQty.value||1);
    unitPrice.textContent = `Цена: ${selectedType.unit_price} ₽`;
    totalPrice.textContent = `Всего: ${(selectedType.unit_price*qty).toLocaleString('ru-RU')} ₽`;
  }
  taskQty.addEventListener('input', ()=> setTimeout(updatePrices,150));

  // URL checker with debounce
  let urlTimer = 0;
  taskUrl.addEventListener('input', ()=>{
    clearTimeout(urlTimer);
    urlStatus.textContent=''; urlChecker.style.display='none';
    const v = taskUrl.value.trim();
    if (!v) return;
    urlChecker.style.display='inline-block'; urlStatus.textContent='Проверка…';
    urlTimer = setTimeout(async ()=>{
      const r = await checkUrl(v);
      urlChecker.style.display='none';
      if (r.ok === true) { urlStatus.textContent='✅'; urlStatus.style.color='#28a745'; }
      else if (r.ok === false) { urlStatus.textContent='❌ '+(r.message||'Недоступно'); urlStatus.style.color='#ff4d6d'; }
      else { urlStatus.textContent='⚠ '+(r.message||'CORS'); urlStatus.style.color='#d7a700'; }
    },600);
  });
  async function checkUrl(url){
    if (!/^https?:\/\//i.test(url)) return {ok:false,message:'Должна быть с http(s)://'};
    try {
      const r = await fetch(url,{method:'HEAD',mode:'cors'});
      return {ok:r.ok};
    } catch(e){
      try { await fetch(url,{method:'GET',mode:'no-cors'}); return {ok:null,message:'Проверка ограничена (CORS)'}; } catch(e2){ return {ok:false,message:'Не удалось'}; }
    }
  }

  // Create task
  submitTaskBtn.addEventListener('click', async ()=>{
    const url = taskUrl.value.trim(); const qty = Number(taskQty.value||0);
    if (!selectedType) return alert('Выберите тип');
    if (!url) return alert('Введите ссылку');
    if (!qty || qty<1) return alert('Количество > 0');
    const chk = await checkUrl(url);
    if (chk.ok === false) return alert('Ссылка нерабочая: '+(chk.message||''));
    if (chk.ok === null && !confirm('Невозможно автоматически проверить ссылку — создать всё равно?')) return;
    try {
      const body = { title: selectedType.name, description:selectedType.name, unit_price:selectedType.unit_price, qty, url, type_id:selectedType.id, owner_uid:uid };
      const r = await fetch('/api/tasks/create',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(body)});
      const j = await r.json();
      if (j && j.ok) { alert('Задание создано'); closeCreateModal(); await loadTasks(); }
      else alert((j&&j.errmsg) || 'Ошибка создания');
    } catch(e){ console.error(e); alert('Ошибка сети'); }
  });

  // Topup flow
  let topupCurrent = null;
  createTopup.addEventListener('click', async ()=>{
    const amount = Number(topupAmount.value||0);
    if (!amount || amount < 150) return alert('Мин. 150 ₽');
    try {
      const r = await fetch('/api/user/topup-link',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({uid,amount})});
      if (!r.ok) throw new Error('status '+r.status);
      const j = await r.json();
      if (j && j.ok) {
        topupResult.style.display='block';
        topupQR.src = j.qr_base64 ? `data:image/png;base64,${j.qr_base64}` : (j.qr_url||'');
        topupManual.value = j.manual_code || (j.topup && j.topup.manual_code) || '';
        topupOpen.href = j.pay_link || '#';
        topupCurrent = (j.topup && j.topup.id) || j.id || null;
        topupMsg.textContent = 'Скопируйте комментарий и оплатите. Затем нажмите "Я оплатил".';
      } else alert((j&&j.errmsg) || 'Ошибка создания');
    } catch(e){ console.error(e); alert('Ошибка сети: '+e.message); }
  });
  topupIpaid.addEventListener('click', async ()=>{
    if (!topupCurrent) return alert('Создайте заявку');
    try {
      const r = await fetch('/api/user/topup-confirm',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({topup_id:topupCurrent,uid})});
      const j = await r.json();
      if (j && j.ok) { alert('Отправлено на проверку'); closeTopupModal(); await loadProfile(); }
      else alert((j&&j.errmsg) || 'Не удалось подтвердить');
    } catch(e){ alert('Ошибка сети'); }
  });

  // Withdraw
  sendWithdrawBtn.addEventListener('click', async ()=>{
    const amount = Number(wAmount.value||0);
    if (!amount || amount < 300) return alert('Мин. 300 ₽');
    if (amount > (window.__USER_BALANCE||0)) return alert('Недостаточно средств');
    const name = wName.value.trim(), details = wDetails.value.trim();
    if (!name || !details) return alert('Заполните поля');
    try {
      const r = await fetch('/api/user/withdraw',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({uid,amount,name,details})});
      const j = await r.json();
      if (j && j.ok) { alert('Заявка отправлена'); closeWithdrawModal(); loadProfile(); }
      else withdrawMsg.textContent = (j&&j.errmsg) || 'Ошибка';
    } catch(e){ withdrawMsg.textContent='Ошибка сети'; }
  });

  // Support
  supportBtn.addEventListener('click', ()=> {
    const tg = 'tg://resolve?domain=LolikMoney';
    const web = 'https://t.me/LolikMoney';
    try { window.open(tg); } catch(e) { window.open(web,'_blank'); }
  });

  // Modal open/close helpers
  function openModal(el){ el.classList.add('open'); el.style.display='flex'; }
  function closeModal(el){ el.classList.remove('open'); el.style.display='none'; }
  // Topup modal wiring
  topupBtn.addEventListener('click', ()=> { openModal(topupModal); topupResult.style.display='none'; topupAmount.value = 150; topupMsg.textContent=''; });
  closeTopup.addEventListener('click', ()=> closeModal(topupModal));
  // Withdraw modal
  withdrawBtn.addEventListener('click', ()=> { openModal(withdrawModal); wAmount.value=''; wName.value=''; wDetails.value=''; withdrawMsg.textContent=''; });
  closeWithdraw.addEventListener('click', ()=> closeModal(withdrawModal));
  cancelWithdrawBtn.addEventListener('click', ()=> closeModal(withdrawModal));
  // Create modal
  createBtn.addEventListener('click', ()=> { openModal(createModal); loadTypes(); });
  closeCreate.addEventListener('click', ()=> closeCreateModal());
  cancelCreateBtn.addEventListener('click', ()=> closeCreateModal());
  function closeCreateModal(){ closeModal(createModal); taskUrl.value=''; taskQty.value=1; urlStatus.textContent=''; urlChecker.style.display='none'; createMsg.textContent=''; }

  // small helpers
  function escapeHtml(s){ if(!s) return ''; return String(s).replace(/[&<>"']/g, m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' })[m]); }

  // filters
  filterAll.addEventListener('click', ()=> renderTasks(false));
  filterMine.addEventListener('click', ()=> renderTasks(true));

  // initial
  showLoader();
  await Promise.allSettled([loadProfile(), loadTasks(), loadTypes()]);
  setTimeout(()=> hideLoader(), 600);

})();
</script>
</body>
</html>
